-

    # ================================================
    # Deploying test nginx
    # ================================================

    - name: Deploy a test Nginx container
      hosts: localhost
      become: yes
      tasks:

    - name: Ensure Docker is installed
      apt:
        name: docker-ce
        state: present
      register: docker_check
      failed_when: docker_check is failed
      changed_when: docker_check is changed

    - name: Pull the latest Nginx image
      docker_image:
        name: nginx
        tag: latest
        source: pull

    - name: Deploy test Nginx container
      docker_container:
        name: test-nginx
        image: nginx:latest
        state: started
        restart_policy: unless-stopped
        ports:
          - "8080:80"

    - name: Verify container is running
      shell: docker ps | grep test-nginx
      register: nginx_running
      failed_when: nginx_running.rc != 0
      changed_when: false

